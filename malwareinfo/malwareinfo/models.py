from django.db import models

class Malware(models.Model):
  sha_256 = models.TextField('Malware identification')

  def __str__(self):
    s = self.sha_256 or '-'

    return '\n\
            SHA-256: {}\n\
            '.format(s)

class PendingRequest(models.Model):
  malware_path = models.TextField()

  def __str__(self):
    m = self.malware_path or '-'

    return '\n\
            Path: {}\n\
            '.format(m)

class ScanRequest(models.Model):
  """
    Attributes:
      response_code   0: item not present; 1: item ready to be retrieved; -2: item still in queue
  """
  permalink = models.TextField(null=True)
  resource = models.TextField(null=True)
  response_code = models.IntegerField(null=True)
  scan_id = models.TextField(null=True)
  verbose_msg = models.TextField(null=True)

  malware = models.ForeignKey(Malware, on_delete=models.CASCADE)

  def __str__(self):
    l = self.permalink or '-'
    r = self.resource or '-'
    c = self.respose_code or '-'
    s = self.scan_id or '-'
    v = self.verbose_msg or '-'

    return '\n\
            Permalink: {}\n\
            Resource: {}\n\
            Response code: {}\n\
            Scan ID: {}\n\
            Message: {}\n\
           '.format(l, r, c, s, v)


class Report(models.Model):
  respose_code = models.IntegerField(null=True)
  verbose_msg = models.TextField(null=True)
  resource = models.TextField(null=True)
  scan_id = models.TextField(null=True)
  md5 = models.TextField(null=True)
  scan_date = models.TextField(null=True)
  positives = models.IntegerField(null=True)
  total = models.IntegerField(null=True)
  permalink = models.TextField(null=True)

  malware = models.ForeignKey(Malware, on_delete=models.CASCADE)

  def __str__(self):
    c = self.respose_code or '-'
    v = self.verbose_msg or '-'
    r = self.resource or '-'
    s = self.scan_id or '-'
    m = self.md5 or '-'
    d = self.scan_date or '-'
    p = self.positives or '-'
    t = self.total or '-'
    l = self.permalink or '-'

    return '\n\
            Response code: {}\n\
            Message: {}\n\
            Resource: {}\n\
            Scan ID: {}\n\
            MD5: {}\n\
            Scand date: {}\n\
            Positives: {}\n\
            Total: {}\n\
            Permalink: {}\n\
           '.format(c, v, r, s, m, d, p, t, l)

class AntivirusReport(models.Model):
  antivirus_name = models.TextField(null=True)
  detected = models.NullBooleanField()
  version = models.TextField(null=True)
  result = models.TextField(null=True)
  update = models.TextField(null=True)

  report = models.ForeignKey(Report, on_delete=models.CASCADE)

  def __str__(self):
    n = self.antivirus_name or '-'
    d = self.detected or '-'
    v = self.version or '-'
    r = self.result or '-'
    u = self.update or '-'

    return '\n\
            Name: {}\n\
            Detected: {}\n\
            Version: {}\n\
            Result: {}\n\
            Update: {}\n\
            '.format(n, d, v, r, u)